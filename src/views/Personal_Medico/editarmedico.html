<!--Funciona link,ya funciona al editar-->
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clinica Simi - Editar Medico</title>
    <link rel="stylesheet" href="../../styles/components.css">
     <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>
    <script>
      (async () => {
        try {
          const response = await fetch('/api/supabase-config');
          const config = await response.json();
          
          window.supabase = window.supabase.createClient(config.url, config.anonKey);
          window.supabaseLoaded = true;
          console.log('Supabase inicializado desde servidor');
        } catch (e) {
          console.error('Error cargando config de Supabase:', e);
          window.supabaseLoaded = false;
        }
      })();
    </script>
</head>
<body>
    <!--header-->
    <div id="header-container"></div>
        <main>
                <div class="titulo-editar-medico">
                <h2 id="codigo-medico">EDITAR DATOS DEL MEDICO [codigo]</h2>
                </div>
                <div class="editar-medico-general">
                <form id="form-medico">
                    <!--Name del causa-->
                    <div class="edit-nombre-medico">
                    <label for="nombre_completo">Nombre Completo:</label>
                    <input type="text" id="nombre_completo" name="nombre_completo" value="[nombre_completo]" required><br>
                    </div>
                    <!--Codigo unico de sepa que bolas-->
                    <div class="edit-curp-medico">
                    <label for="curp">CURP:</label>
                    <input type="text" id="curp" name="curp" value="[curp]" required ><br>
                    </div>
                    <!--En q chambeas papi-->
                    <div class="edit-especialidad-medico">
                    <label for="especialidad">Especialidad:</label>
                    <select class="form-control" name="especialidad" required>
                    <option value="seleccione">Seleccione una opcion..</option>
                    <option value="Pediatra">Pediatra</option>
                    <option value="Pediatra">Ginecologo</option>
                    <option value="Cardiologia">Cardiologia</option>
                    <option value="Dermatologia">Dermatologia</option>
                    </select>
                    </div>
                    <!--Pasa numero üó£ü•µ-->
                    <div class="edit-telefono-medico">
                    <label for="telefono">Tel√©fono:</label>
                    <input type="tel" id="telefono" name="telefono" value="[telefono]" required><br>
                    </div>
                    <!--Cuantos a√±os tienes (que no te ba√±as)-->
                    <div class="edit-edad-medico">
                    <label for="edad">Edad:</label>
                    <input type="number" id="edad" name="edad" value="[edad]" required value="" required><br>
                    </div>
                    <!--Elmo sabe donde vives ktm-->
                    <div class="edit-direccion-medico">
                    <label for="direccion">Direcci√≥n:</label>
                    <input type="text" id="direccion" name="direccion" value="[direccion]" required><br>
                    </div>
                    <!--Codigo aquino en la tienda de fortnite-->
                    <div class="edit-codigo-medico">
                    <label for="codigo">C√≥digo M√©dico:</label><!--que tipo de codigo es? lo van a poner a mano?-->
                    <input type="text" id="codigo" name="codigo" value="[codigo]" required><br>
                    </div>
                        <div class="botones-medico">
                        <button type="submit" class="actualizar-medico">Guardar Cambios</button>
                        <button onclick="location.href='medico.html'" class="cancelar-medico">Cancelar</button>
                        </div>
            </form>
            </label>
            </div>
        </main>
    <!--footer-->
    <div id="footer-container"></div>
    
    <script type="module">
        //codigo para que guarde y en ense√±e datos
        import { MedicoController } from '/src/controllers/MedicoController.js';
        
        //cargar codigo de medico que pasamos desde medicos
         //window.addEventListener('DOMContentLoaded', async () => {
        (async function () {
            const codigo = localStorage.getItem('codigo_medico');
            const titulo = document.getElementById('codigo-medico')
            if(!codigo){
            console.error('no se encontro codigo',error);
            return;
         }
            if(titulo){
                titulo.textContent = `EDITAR DATOS DEL MEDICO ${codigo}`
            }
        
         
        //traer datos con controlador
        const { medico,error} = await MedicoController.obtenerMedicosporCodigo(codigo);
        if(error){
            console.log('fallo traer datos',error)
            return{medico:null,error}
        }
        //para mis inputs del formulario
        document.getElementById("nombre_completo").value = medico.nombre_completo;
        document.getElementById("curp").value = medico.curp;
        document.getElementById("telefono").value = medico.telefono;
        document.getElementById("edad").value = medico.edad;
        document.getElementById("direccion").value = medico.direccion;
        document.getElementById("codigo").value = medico.codigo;
        //para el select (es que quiere ser especial)
        document.querySelector("select[name='especialidad']").value =medico.especialidad;

        //parte de mis botoncitos
        const form = document.getElementById("form-medico");
        
        form.addEventListener("submit", async (e) => {
            e.preventDefault();
            //mi arreglo para guardar los nuevos datos
            const medicoActualizado = {
                nombre_completo: form.nombre_completo.value,
                curp:form.curp.value,
                telefono: form.telefono.value,
                edad:form.edad.value,
                direccion: form.direccion.value,
                especialidad: form.especialidad.value,
                codigo: form.codigo.value,
            };
            const {medico: resultado, error} = await MedicoController.actualizarMedico(codigo, medicoActualizado);
            if(error){
                alert('No se pudo actualizar doctor');
                console.error('Pus no se pudo', error)
                return;
            }
            alert('datos actualizados');
            window.location.href='medico.html';
        });
    })();
    

    </script>
    
    <script>
        //cargar header
        fetch('/header.html')
        .then(response => response.text())
        .then(data => {
            document.getElementById('header-container').innerHTML = data;
        })
        .catch(error => console.error('Error al cargar el header', error));
        //cargar el footer
        fetch('/footer.html')
        .then(response => response.text())
        .then(data => {
            document.getElementById('footer-container').innerHTML = data;
        })
        .catch(error => console.error('Error al cargar el footer', error));
    </script>
</body>
</html>